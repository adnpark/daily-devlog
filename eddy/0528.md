# 단위 테스트(Unit testing)에 대하여

단위 테스트. 
개발을 배우다보면 자연스럽게 접하는 단어다. 

단위 테스트는 중요하다. 들어서 안다. 구구절절 옳다.

하지만 막상 테스트를 직접 짤 때는 느낌이 다르다. 

그렇게 큰 앱도 아닌데, 굳이 테스트까지 해야 하나?
그냥 실행시켜보면 잘 되는지 알 수 있는데? 
왠지 중복처럼 느껴지는 이 코드를 계속 작성해야될까?

그래도 한번 시도해봐야한다는 의무감은 있어서,
단위 테스트를 직접 프로젝트에 적용해보기 시작했다. 

확실히 테스트를 다 짜고 나서 통과시키면, 
초록색 성공 마크와 띠링- 소리가 꽤 기분 좋았다.

하지만 테스트 코드를 쓰는 건 생각보다 쉽지 않았다. 

시행 착오도 많이 겪었다. 

앱 만드는 것도 공부할 게 많은데,
테스트 짜는 것도 따로 공부를 해야한다니.

터치 입력 같은 걸 테스트할 때는
'이런 것까지 테스트해야하나?' 라는 의문도 들었다.

도대체 테스팅을 어떻게 하는 게 효과적인 걸까? 
궁금해서 열심히 찾아보게 됐다.

그 과정에서 내가 했던 고민과, 
공부한 지식을 내 언어로 한번 정리해보려 한다.

단위 테스트를 해야하는 이유가 뭐냐?

이렇게 묻는다면 한 마디로 대답할 수 있다. 

> 테스트가 있으면 변경이 두렵지 않다.

단위 테스트 없이 개발을 한다고 생각해보자. 

테스트가 없으면 개발자가 시스템의 한쪽 부분을 수정했을 때, 
다른 쪽이 모두 이상없이 돌아가는지 확인하기가 매우 어렵다. 
(특히나 규모가 크고 복잡하면 더욱 그렇다.) 

아키텍처가 유연하고 설계가 훌륭해도 마찬가지다. 
언제나 우리가 예상 못하는 사이드 이펙트가 있을 수 있고,
우리는 버그 없음을 '확신'할 수단이 없다.

이러면 변경을 하면서 소프트웨어에 예상치 못한 버그가 쌓인다. 
개발자는 코드를 변경할 때마다 심리적인 압박을 받는다. 
'버그가 생기면 어떡하지? 바꾸지 말고 적당히 땜빵해놓자.'

여기서 악순환이 시작된다. 
코드를 정리하다가 망가질 위험이 있으니, 
코드를 정리하지 않는다. 

코드를 정리하지 않으니 
코드는 복잡해진다. 

코드가 복잡하게 꼬여있으니 
변경하기가 더 어려워진다. 

단위 테스트는 이런 상황이 안 생기게 막아준다.

단위 테스트가 있으면, 
코드를 리팩토링하고 잘 돌아가는지 확인한다.
기능을 추가하고 잘 돌아가는 지 확인한다. 

리팩토링과 기능 추가를 할 때 부담이 가벼워진다.

단위 테스트는 코드를 유연하고, 
확장가능하게 만드는 버팀목 역할을 한다.

## 그거 말고는 없어?

위의 이유가 가장 중요하다 본다. 하지만 몇 가지 더 장점도 있다.

### 객체 간의 결합도가 낮아진다. 

테스트를 하려면 소프트웨어를 이루는 모듈들을 분리하고 교체하기 쉬워야 한다. 

객체는 어떤 일을 하기 위해서 다른 객체에 의존한다.

A 객체가 자신이 의존할 B 객체를 직접 내부에서 생성하고 호출한다면,

우리가 테스트하고자 하는 A 객체의 '단위'가 A가 의존하는 B 객체에 영향을 받는다.

A 객체가 의존하는 부분은 테스트 시점에 갈아끼울 수 있어야 한다. 우리가 테스트하려는 부분만 '고립'시킬 수 있어야한다. 그래야 제대로 된 테스트를 할 수 있다.

웨이트 트레이닝을 배워본 사람은 '고립'을 들어봤을거다. 내가 가슴 근육을 키우려면, 어깨 근육의 개입을 차단한 다음 벤치 프레스를 들어올려야 한다. 
그래야 내가 원하는 근육에만 부하가 간다. 이걸 '고립'이라고 하는데, 테스트의 '고립'도 같은 맥락이다. 

테스트 시점에 의존하는 객체를 갈아끼우려면, 외부에서 의존성을 주입해줄 수 있는 구조가 되어야 한다. 

이런 구조를 만들려다보면, 객체 간의 결합도를 낮추게 된다. 

테스트 가능하게 만들다보면, 원래 코드의 퀄리티가 좋아지는 효과가 있다.

### 테스트를 잘 쓰면 좋은 설명서가 된다.

읽기 좋은 테스트를 만들면, 소프트웨어의 기능을 설명하는 설명서 역할을 한다.

알고리즘 문제를 풀 때를 떠올려보자. 

알고리즘이 해야하는 일을 줄줄 설명해놓은 글을 읽는다. 

원소의 개수가 n개이고, 중복되는 원소가 없는 배열이 주어질 때... 어쩌구...
여전히 잘 이해가 안 된다. 

그러다 알고리즘 '입출력 예시'를 보면, '아하' 하고 불이 켜진다.

테스트 케이스도 마찬가지다. 테스트는 '이런 상황에서 이렇게 결과가 나와야 한다'는 예시를 보여준다.  덕분에 코드의 동작을 이해하기가 쉬워진다.

### TDD를 할 수 있다.

나는 처음에 테스트를 하면, 다 TDD라고 부르는 줄 알았다. 

나중에 알고보니, TDD는 그냥 테스팅과는 좀 달랐다. 실제 코드를 짤 때 사용하는 개발 방법론에 가까웠다.

TDD를 하려면 코드를 쓰기 전에 테스트를 작성한다. 이 코드가 '무엇을 해야하는지' 코딩을 하기 전에 생각하도록 강제한다. 

테스트가 통과하도록 코드를 짠다. 리팩터링을 한다. 테스트를 다시 작성한다.

프로그래머는 좀 더 깔끔하고 작게 쪼개진 코드를 쓸 수 있게 된다.

하지만 '단위 테스팅'은 테스트의 시점을 강제하지 않는다. 
대개는 코드를 쓰고 나서 테스트를 작성한다. 

TDD와 단위 테스팅은 서로 다른 개념이다.

하지만 어쨌든 TDD는 테스트에 의존하는 개발이다. 
TDD를 하기 위해 테스트 케이스는 기본 조건이라 할 수 있다. 





